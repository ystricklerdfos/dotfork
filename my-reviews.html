<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
    <title>My Reviews - DOTFORK</title>
    <link rel="stylesheet" type="text/css" href="styles.css">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
<script defer src="https://cloud.umami.is/script.js" data-website-id="f831e49e-3ace-447b-b0bd-33e8ad810414"></script>
</head>
<body>

<!-- Header -->
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
    <td class="header">
        <div class="logo-container">
            <a href="index.html"><img src="images/logo.svg" alt="DOTFORK" class="logo-icon"></a>
            <div class="logo"><a href="index.html">DOTFORK</a></div>
        </div>
        <div class="tagline">The Most Trusted Voice in Dot-Com Criticism</div>
    </td>
</tr>
</table>

<!-- Navigation -->
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
    <td class="nav">
        <a href="index.html">Home</a>
        <a href="archive.html">Reviews</a>
        <a href="lists.html">Lists</a>
        <a href="features.html">Features</a>
        <a href="deals.html">Deals</a>
        <a href="generator.html">Generator</a>
        <a href="about.html">About</a>
    </td>
</tr>
</table>

<!-- Main Content -->
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
    <td class="container">

        <h1>My Reviews</h1>
        <p style="margin-bottom: 20px; color: #666; font-size: 13px;">
            Your locally saved reviews. Submit them to the community archive to share with others.
        </p>

        <div style="margin-bottom: 30px;">
            <a href="generator.html" style="display: inline-block; background-color: #ff3530; color: #ffffff; padding: 10px 20px; font-size: 12px; font-weight: 700; text-decoration: none; text-transform: uppercase; letter-spacing: 0.5px;">+ Generate New Review</a>
            <a href="community.html" style="display: inline-block; margin-left: 10px; background-color: #333; color: #ffffff; padding: 10px 20px; font-size: 12px; font-weight: 700; text-decoration: none; text-transform: uppercase; letter-spacing: 0.5px;">View Community Archive</a>
        </div>

        <div id="reviewsList">
            <p style="color: #999; font-style: italic;">Loading your reviews...</p>
        </div>

        <div id="emptyState" style="display: none; text-align: center; padding: 60px 20px; color: #999;">
            <div style="font-size: 48px; margin-bottom: 20px;">&#128221;</div>
            <div style="font-size: 16px; margin-bottom: 10px;">No reviews yet</div>
            <div style="font-size: 13px;">
                <a href="generator.html" style="color: #ff3530;">Generate your first review</a>
            </div>
        </div>

    </td>
</tr>
</table>

<!-- Footer -->
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
    <td class="footer">
        &copy; 1999-2026 DOTFORK. All rights reserved.<br>
        Last updated: January 12, 2026
    </td>
</tr>
</table>

<script>
const USER_REVIEWS_KEY = 'dotfork_user_reviews';
const COMMUNITY_API = '/api/community-reviews';

function getUserReviews() {
    try {
        const stored = localStorage.getItem(USER_REVIEWS_KEY);
        return stored ? JSON.parse(stored) : [];
    } catch {
        return [];
    }
}

function deleteReview(filename) {
    if (!confirm('Delete this review?')) return;

    const reviews = getUserReviews();
    const filtered = reviews.filter(r => r.filename !== filename);
    localStorage.setItem(USER_REVIEWS_KEY, JSON.stringify(filtered));
    renderReviews();
}

async function submitToCommunity(filename) {
    const reviews = getUserReviews();
    const review = reviews.find(r => r.filename === filename);
    if (!review) return;

    const btn = document.querySelector(`[data-submit="${filename}"]`);
    if (btn) {
        btn.disabled = true;
        btn.textContent = 'SUBMITTING...';
    }

    try {
        const response = await fetch(COMMUNITY_API, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(review)
        });

        if (!response.ok) {
            const error = await response.json();
            throw new Error(error.message || 'Failed to submit');
        }

        // Mark as submitted locally
        review.submitted = true;
        review.submittedAt = new Date().toISOString();
        localStorage.setItem(USER_REVIEWS_KEY, JSON.stringify(reviews));

        alert('Review submitted to community archive!');
        renderReviews();
    } catch (e) {
        alert('Error submitting: ' + e.message);
        if (btn) {
            btn.disabled = false;
            btn.textContent = 'SUBMIT TO COMMUNITY';
        }
    }
}

function viewFullReview(filename) {
    const reviews = getUserReviews();
    const review = reviews.find(r => r.filename === filename);
    if (!review) return;

    const modal = document.createElement('div');
    modal.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.85); z-index: 1000; overflow-y: auto; padding: 20px;';

    const paragraphs = review.reviewText ? review.reviewText.split('\n\n').map(p => `<p>${p}</p>`).join('') : '<p>No review text available.</p>';
    const bnwBadge = review.isBNW ? '<span class="bnw-badge">Best New Website</span>' : '';

    modal.innerHTML = `
        <div style="max-width: 800px; margin: 40px auto; background: white; padding: 40px; position: relative;">
            <button onclick="this.closest('div').parentElement.remove()" style="position: absolute; top: 15px; right: 15px; background: none; border: none; font-size: 28px; cursor: pointer; color: #999; line-height: 1;">&times;</button>
            <div class="review-header">
                <h1 class="review-title" style="margin: 0 0 12px 0;">${review.site?.name || 'Unknown'}</h1>
                <div class="review-meta">${review.category || 'Unknown'} | Reviewed by ${review.reviewer || 'Unknown'} | ${review.date || ''}</div>
                <div class="review-url"><a href="https://${review.site?.url || '#'}" target="_blank" style="color: #ff3530;">${review.site?.url || ''}</a></div>
                <div class="rating">${review.rating?.toFixed(1) || '0.0'}</div>
                ${bnwBadge}
            </div>
            <div class="review-body" style="margin-top: 25px;">${paragraphs}</div>
            <div class="verdict-box" style="margin-top: 25px;"><strong>VERDICT:</strong> ${review.verdict || ''}</div>
        </div>
    `;

    document.body.appendChild(modal);
    modal.addEventListener('click', (e) => {
        if (e.target === modal) modal.remove();
    });
}

function renderReviews() {
    const reviews = getUserReviews();
    const container = document.getElementById('reviewsList');
    const emptyState = document.getElementById('emptyState');

    if (reviews.length === 0) {
        container.innerHTML = '';
        emptyState.style.display = 'block';
        return;
    }

    emptyState.style.display = 'none';

    let html = '';
    reviews.forEach(review => {
        const bnwBadge = review.isBNW ? '<span class="bnw-badge">Best New Website</span>' : '';
        const submittedBadge = review.submitted
            ? '<span style="display: inline-block; background: #4CAF50; color: white; font-size: 10px; padding: 3px 8px; margin-left: 8px; font-weight: 700;">IN COMMUNITY ARCHIVE</span>'
            : '';
        const submitBtn = review.submitted
            ? ''
            : `<button data-submit="${review.filename}" onclick="submitToCommunity('${review.filename}')" style="background: #333; color: white; border: none; padding: 6px 12px; font-size: 10px; cursor: pointer; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; margin-right: 8px;">Submit to Community</button>`;

        html += `
            <div style="margin-bottom: 25px; padding: 20px; background: #f9f9f9; border-left: 3px solid ${review.submitted ? '#4CAF50' : '#ff3530'};">
                <div style="margin-bottom: 12px;">
                    <span style="font-size: 18px; font-weight: 700;">${review.site?.name || 'Unknown'}</span>
                    <span class="rating-small">${review.rating?.toFixed(1) || '0.0'}</span>
                    ${bnwBadge}
                    ${submittedBadge}
                </div>
                <div style="font-size: 12px; color: #999; margin-bottom: 12px;">
                    ${review.site?.url || ''} | ${review.category || ''} | Reviewed by ${review.reviewer || ''} | ${review.date || ''}
                </div>
                <div style="font-size: 13px; color: #555; margin-bottom: 15px; line-height: 1.5;">
                    <strong>VERDICT:</strong> ${review.verdict || ''}
                </div>
                <div>
                    <button onclick="viewFullReview('${review.filename}')" style="background: #ff3530; color: white; border: none; padding: 6px 12px; font-size: 10px; cursor: pointer; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; margin-right: 8px;">View Full Review</button>
                    ${submitBtn}
                    <button onclick="deleteReview('${review.filename}')" style="background: none; color: #999; border: 1px solid #ddd; padding: 6px 12px; font-size: 10px; cursor: pointer; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px;">Delete</button>
                </div>
            </div>
        `;
    });

    container.innerHTML = html;
}

// Render on page load
renderReviews();
</script>

</body>
</html>
